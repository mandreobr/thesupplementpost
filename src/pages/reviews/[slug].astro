---
import FullReviewLayout from "../../layouts/FullReviewLayout.astro";
import MiniReviewWhatIsLayout from "../../layouts/MiniReviewWhatIsLayout.astro";
import { getCollection } from "astro:content";

// üî• Gera todas as p√°ginas de reviews automaticamente
export async function getStaticPaths() {
  const reviews = await getCollection("reviews");

  return reviews.map((entry) => {
    // Usamos o slug definido no frontmatter (data.slug).
    // Se n√£o tiver, ca√≠mos no slug gerado pelo Astro (√∫ltima parte do path).
    const dataSlug = entry.data.slug;
    const fallbackSlug = entry.slug.split("/").pop();
    const slug = dataSlug || fallbackSlug;

    if (!slug) {
      throw new Error(`Missing slug for entry: ${entry.id}`);
    }

    return {
      params: { slug },
      props: { entry, slug },
    };
  });
}

// üî• Recebe o conte√∫do individual de cada review
const { entry, slug } = Astro.props;
const data = entry.data;
const { Content } = await entry.render();

// Detecta se √© mini review "what-is"
const isWhatIs =
  typeof slug === "string" && slug.toLowerCase().endsWith("-what-is");

// Canonical completo (sempre com www ou usa o do frontmatter se existir)
const canonicalUrl =
  data.canonicalUrl ??
  `https://www.thesupplementpost.com/reviews/${slug}`;
---

{isWhatIs ? (
  <MiniReviewWhatIsLayout
    pageTitle={data.pageTitle}
    metaDescription={data.metaDescription}
    footerCtaLabel={data.footerCtaLabel}
    footerCtaUrl={data.footerCtaUrl}
    footerText={data.footerText}
    category={data.category}
    canonicalUrl={canonicalUrl}
  >
    <Content />
  </MiniReviewWhatIsLayout>
) : (
  <FullReviewLayout
    pageTitle={data.pageTitle}
    metaDescription={data.metaDescription}
    footerCtaLabel={data.footerCtaLabel}
    footerCtaUrl={data.footerCtaUrl}
    footerText={data.footerText}
    category={data.category}
    canonicalUrl={canonicalUrl}
  >
    <Content />
  </FullReviewLayout>
)}
